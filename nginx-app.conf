server {
    listen 80;
    server_name localhost;

    # Increase allowed file size (adjust value as needed)  
    client_max_body_size 10M;  

    root /usr/share/nginx/html;  
    index index.html;  

    # Serve static files generated from your React build.  
    location / {  
        try_files $uri $uri/ /index.html;  
    }  

    # Proxy API HTTP calls (adjust the rewrite if your backend doesnâ€™t expect /api prefix)  
    location /api/ {  
        rewrite ^/api/(.*)$ /$1 break;  
        proxy_pass http://backend:8000;  
        proxy_http_version 1.1;  
        proxy_set_header Upgrade $http_upgrade;  
        proxy_set_header Connection "keep-alive";  
        proxy_set_header Host $host;  
        proxy_cache_bypass $http_upgrade;  
    }  

    # Proxy WebSocket connections  
    location /ws/ {  
        proxy_pass http://backend:8000/ws/;  
        proxy_http_version 1.1;  # WebSockets require HTTP/1.1 for upgrade support.  
        proxy_set_header Upgrade $http_upgrade;  
        proxy_set_header Connection "upgrade";  # Essential for the protocol upgrade.  
        proxy_set_header Host $host;  
        proxy_cache_bypass $http_upgrade;  
    }  

    # Proxy requests to the Express server (server image)  
    # This rewrites /server/* to /api/* so that Express (which mounts its routes under /api)  
    # receives the path it expects.  
    location /server/ {  
        rewrite ^/server/(.*)$ /api/$1 break;  
        proxy_pass http://server:4000;  
        proxy_http_version 1.1;  
        proxy_set_header Upgrade $http_upgrade;  
        proxy_set_header Connection "keep-alive";  
        proxy_set_header Host $host;  
        proxy_cache_bypass $http_upgrade;  
    }
}